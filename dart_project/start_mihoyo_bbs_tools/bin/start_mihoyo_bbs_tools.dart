import 'dart:io';
import 'dart:math';
import 'package:cron/cron.dart';
import 'package:path/path.dart';

void main(List<String> args) async {
  final cron =  Cron();

  print("Started successfully at ${DateTime.now().toString()}");

  stdout.write('\x1B[38;2;0;0;255m$text\x1B[0m');

  print("============================================================");

  cron.schedule(Schedule.parse("0 0 9 * * *"), () async {
    try {
      int number = Random().nextInt(10800) + 1;
      print("Sleep: ${number}s");
      sleep(Duration(seconds: number));

      final p = await Process.run("python3", ["${dirname(Platform.resolvedExecutable)}/main.py"], workingDirectory: dirname(Platform.resolvedExecutable), runInShell: true);

      print("pid: ${p.pid}");
      print("exitcode: ${p.exitCode}");
      print("============================================================");
    } catch (e) {
      print("miHoYo Tools启动失败");
    }
  });
}

final String text = r"""                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                     |||                                                                                  ||                ||                  ||                        
                    |||                |||||||||||                               ||      |||           || || ||            ||||                 |||               |||     
                    |||          |||||||||||||||||                               |||     |||      ||||||||||||||            |||                ||||||||||||       |||     
            ||||||| |||||||||    |||||| ||||||||||                           ||   |||    ||      |||||||  ||  |||            |||              ||||||||||||        |||     
            ||||||| |||||||||    || ||| ||||||||||                           ||   ||||   ||      || |||   ||   ||     |||||||||||||||        |||       ||         |||     
                ||| |||||||||    || ||| ||      ||                           ||    |||  |||         |||   ||   |      |||||||||||||||       ||||||    |||         |||     
            ||| || |||    ||     || ||||||||||||||                           ||     ||  |||     |||||||||||||||||||   |||||||||||||||      ||||||||  |||          |||     
            ||| || || ||| ||     || ||||||||||||||                           ||         |||     |||||||||||||||||||            ||||         ||   ||||||           ||      
             |||||||| |||        || |||                                      ||         |||         |||   ||   ||             ||||                ||||            ||      
              ||||    |||        || |||||||||||||||                          ||   |     ||          |||   |||  |||           ||||                ||||             ||      
               |||    |||        || |||||||||||||||                          ||   ||    ||          ||||||||| |||           ||||              |||||||||||||       ||      
              ||||    |||        ||||||||       |||                          ||  |||   |||      |||||||||| || ||           |||             ||||||||||||||||       ||      
              |||||  |||||       ||||||||||||||||||                          || |||   ||||      |||||||    |||||          |||             |||||||        ||       ||      
             ||| ||  || ||       ||||||||||||||||||                          |||||    |||||      || |||    ||||         ||||               ||  ||        ||               
            |||  || ||| |||      || |||||       |||   ||                     ||||   ||||||||        |||    |||   |     |||||                   ||        ||       |||     
            |||    |||   |||     ||    ||||||||||||   ||                    ||||   ||||  ||||       |||  ||||||  ||   |||||||||                ||||||||||||       |||     
           |||    |||     ||||         ||||||||||||   ||                    |||  |||||    |||     |||||||||| ||||||  |||   |||||||||||||       ||||||||||||       |||     
                 |||       |||         ||       |||   ||                     |  ||||       ||     ||||||||    ||||     |     ||||||||||        ||        ||               
                  |         |          ||             |                          ||                ||          |||                            |||        ||                                                                                                                                                                                   
""";
